
<!-- <!DOCTYPE HTML SYSTEM "html.dtd"> -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
"http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>
<TITLE>Simplex Pivot Tool</TITLE>
<LINK REL="SHORTCUT ICON" HREF="/myshield.png" TYPE="image/png">
<LINK REL="stylesheet" HREF="boundedsimplex.css" TYPE="text/css" MEDIA="screen">
<meta charset="utf-8"/>
<script src="sprintf.js" type="text/javascript"></script>
<SCRIPT language="javascript">
  var m=3, n=4;
  var m0=0, n0=0;
  var mmn=0;
  var a=[];
  var b=[];
  var c=[];
  var l=[];
  var u=[];
  var basics=[];
  var upperbound=[];
  var lowerbound=[];
  var lb=[];
  var ub=[];
  var vb=[];
  var obj;
  var element;
  var method;
  var xlabel = [], wlabel = [], llabel=[], ulabel=[],lblabel=[],ublabel=[];
  method = "Primal";

  var ctx = null;

  var rowlist = [];
  var collist = [];
  var listlen;

  var fmt="Fraction";
  var vis="Visible";
  var width=0;
  var precision=8;

  var xlo, xhi, ylo, yhi, plotwid;

  var meg, bark;
  // FOLLOWING LINES ARE TO TEST THE BROWSWER SINCE meg.load() DOESN'T WORK IN
  // CHROME
  // Opera 8.0+
  var isOpera = (!!window.opr && !!opr.addons) 
	|| !!window.opera 
	|| navigator.userAgent.indexOf(' OPR/') >= 0;
  // Firefox 1.0+
  var isFirefox = typeof InstallTrigger !== 'undefined';
  // Safari 3.0+ "[object HTMLElementConstructor]" 
  var isSafari = Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor') > 0 
  || (function (p) { return p.toString() === "[object SafariRemoteNotification]"; })(!window['safari'] 
  || safari.pushNotification);
  // Internet Explorer 6-11
  var isIE = /*@cc_on!@*/false || !!document.documentMode;
  // Edge 20+
  var isEdge = !isIE && !!window.StyleMedia;
  // Chrome 1+
  var isChrome = !!window.chrome && !!window.chrome.webstore;
  // Blink engine detection
  var isBlink = (isChrome || isOpera) && !!window.CSS;


  var sub = [];

  sub[0] = "\u2080"; sub[1] = "\u2081"; sub[2] = "\u2082"; sub[3] = "\u2083"; sub[4] = "\u2084";
  sub[5] = "\u2085"; sub[6] = "\u2086"; sub[7] = "\u2087"; sub[8] = "\u2088"; sub[9] = "\u2089";
  for (i=1; i<10; i++) {
      for (j=0; j<10; j++) {
	  sub[10*i + j] = sub[i]+sub[j];
      }
  }

  function add(type,name,width,row,rw,clas,id) {
  
	  //Create an input type dynamically.
	  element = document.createElement("input");
  
	  //Assign different attributes to the element.
	  element.setAttribute("type", type);
	  element.setAttribute("value", name);
	  element.setAttribute("name", name);
	  element.setAttribute("size", width);
	  element.setAttribute("class", clas);
	  element.setAttribute("onchange", "ck_edits(); toGrid()");
	  element.setAttribute("id", id);
	  if (rw == "readonly") { 
	      element.setAttribute("readonly","");
	  }
          /*
          if (type == "text") {
              element.setAttribute("onfocus", "makeitshow(id)");
              element.setAttribute("onblur", "toGrid()");
          }
          */
          if (type == "text" && clas != "sign" && clas != "var") {
              element.setAttribute("onmouseover", "makeitshow(id)");
              element.setAttribute("onmouseleave", "ck_edits(); toGrid()");
          }
  
  
	  var rowElement = document.getElementById("rowStuff"+row);
  
	  //Append the element in page (in span).
	  rowElement.appendChild(element);
  
  }

  function makeitshow(id) {
          var element;
          element = document.getElementById(id);
          if (element != null && element.value == 0) {
                  element.className = "val"; 
          }
  } 

  function removeElements(elements) {
	  for (var i=0; i<elements.length; i++) {
		elements[i].parentNode.removeChild(elements[i]);
	  }
  }
  
  function setm(v) { 
	  m = 1*v.valueOf(); 
	  if (m>18) {
	    m=18;
            document.getElementById("m").value = m;
	  }
	/*  if (method == "Klee-Minty") {
            document.getElementById("n").value = m;
	    n = 2*m;
	  }
	  if (method == "Lexicographic") {
	    n = 1.0*document.getElementById("n").value;
	  }*/
	  start();
  }
  function setn(v) { 
	  n0 = n;
	  n = 1*v.valueOf(); 
	 /* if (method == "Klee-Minty") {
            document.getElementById("m").value = n;
	    m = n;
	    n = 2*n;
	  }*/
	  /*
	  if (method == "Lexicographic") {
	    n = m+n;
	  }
	  */
	  start();

	  /*if (n==2 || (n==3 && method == "Primal w/ x0" )) {
	     plotcanvas = document.getElementById("plot2d");
	     ctx = plotcanvas.getContext('2d');
	     ctx.canvas.height = "400";
	     ctx.canvas.width = "400";
	     // ctx.font = "12px Helvetica, sans-serif";
	     ctx.font = "12px Letter Gothic Std, sans-serif";
	     // ctx.font = "12px Arial, sans-serif";
	  } else {*/
	     plotcanvas = document.getElementById("plot2d");
	     ctx = plotcanvas.getContext('2d');
	     ctx.canvas.height = "0";
	     ctx.canvas.width = "0";
	  
          console.log("setn");
          toGrid();
  }
  function setMethod(v) { method = v.valueOf(); start();}
  // function setFormat(v) { fmt = v.valueOf(); ck_edits(); toGrid();}
  // function setVisibility(v) { vis = v.valueOf(); ck_edits(); toGrid();}
  function setFormat(v) { 
          var ctr_right;
          fmt = v.valueOf(); 
          if (fmt == "Fraction") {ctr_right = "center";} else {ctr_right = "right";}
          if (document.getElementById("zstar") != null) 
              document.getElementById("zstar").style.textAlign = ctr_right; 
          for (i=1; i<=m; i++) {
	      document.getElementById("b"+i).style.textAlign = ctr_right;
           document.getElementById("vb"+i).style.textAlign = ctr_right;
              for (j=1; j<=n; j++) {
		  document.getElementById("a"+i+","+j).style.textAlign = ctr_right;
          
              }
              }
              for (j=1; j<=n; j++) {
              document.getElementById("l"+(m+1)+","+j).style.textAlign = ctr_right;}
               for (j=1; j<=n; j++) {
              document.getElementById("u"+(m+2)+","+j).style.textAlign = ctr_right;}
          for (j=1; j<=n; j++) { document.getElementById("c"+j).style.textAlign = ctr_right; }
           for (j=1; j<=m; j++) { document.getElementById("ub"+j).style.textAlign = ctr_right; }
          for (j=1; j<=m; j++) { document.getElementById("lb"+j).style.textAlign = ctr_right; }
          console.log("setFormat");
          toGrid();
  }
  function setVisibility(v) { vis = v.valueOf(); toGrid();}
  function setExercise(v) {
          n0 = n;
	  obj = 0;

	  if (v.valueOf() == "--") {
	      start();
	      for (j=1; j<=n; j++) { c[j] = 0; }
	      for (i=1; i<=m; i++) {
	         for (j=1; j<=n; j++) { a[i][j] = 0; }
	         b[i] = 0; vb[i]=0; lb[i]=0;ub[i]=0;}
           for (j=1; j<=n; j++) { l[m+1][j] = 0;u[m+2][j]=0 }  
             
	  } else {}
	 
          console.log("setExercise");
	  toGrid();
  }

  function xpx(x) { return plotwid*(x+2)/11;  }
  function ypx(y) { return plotwid - plotwid*(y+2)/11;  }

  function pxx(x) { return 11*x/plotwid;  }
  function pxy(y) { return 11*y/plotwid;  }

  function reset() {
	var elements;
	elements = document.querySelectorAll("#rowStuff"+0+" input");
	for (j=1; j<=n; j++) {
	    c[j] = ""
	    elements[3*j+1].value = ""+c[j];
	    elements[3*j+1].className = "val"; 
	}
	for (i=1; i<=m; i++) {
	    elements = document.querySelectorAll("#rowStuff"+i+" input");
	    lb[i] = ""
	    elements[2].value = ""+lb[i];
	    elements[2].className = "val"; 
         ub[i] = ""
	    elements[6].value = ""+ub[i];
	    elements[6].className = "val"; 
         b[i] = ""
	    elements[10].value = ""+b[i];
	    elements[10].className = "val"; 
	    a[i] = [];
	    for (j=1; j<=n; j++) {
	        a[i][j] = ""
	         elements[(3*j+1)+8].value = ""+a[i][j];
	        elements[(3*j+1)+8].className = "val"; 
          
	    }
        l[m+1]=[];
        u[m+2]=[];
        for (j=1; j<=n; j++){
          l[m+1][j] = ""
	        elements[3*j].value = ""+l[i][j];
	        elements[3*j].className = "val"; 
             u[m+2][j] = ""
	        elements[3*j].value = ""+u[i][j];
          }
	        elements[(3*j+1)+8].className = "val"; 
	}

	listlen = 0;
	for (var i=0; i<100; i++) rowlist[i] = -1;
  } 

   function genrand() {
	var xinit = [];
	var winit = [];
	var zinit = [];
	var yinit = [];
	var lower=0;
	var upper=0;
    

if(n>2){  
for(i=1;i<=2;i++){ 
     element=document.getElementById("l"+(m+1)+","+i);
      element.style.backgroundColor = "#ffaa80";
     for(j=3;j<=n;j++){document.getElementById("u"+(m+2)+","+j).style.backgroundColor = " #b3b3ff";}
     }
    }
    else if(n==1){document.getElementById("l"+(m+1)+","+1).style.backgroundColor = "#ffaa80";}else{document.getElementById("l"+(m+1)+","+1).style.backgroundColor = "#ffaa80";document.getElementById("u"+(m+2)+","+2).style.backgroundColor = " #b3b3ff";}


// ==================================================
	for (i=1; i<=m; i++) { a[i] = [];}
 

	var scale, shift;
	scale = (m+2)+n; shift = Math.floor(scale/2); 
    for(j=1;j<=n;j++){tmp = document.getElementById("l"+(m+1)+","+j);
    tmp.value=-1* Math.floor(scale*myrand());
    }
    for(j=1;j<=n;j++){tmp = document.getElementById("u"+(m+2)+","+j);
    tmp.value= Math.floor(scale*myrand());
    }
	
	    for (i=1; i<=m; i++) {
		for (j=1; j<=n; j++) {
		    a[i][j]  = Math.floor(scale*myrand())-shift;
		    a[i][j] += Math.floor(scale*myrand())-shift;
		    a[i][j] += Math.floor(scale*myrand())-shift;
		}
	    }
       
		
		
	   
	
	if ( myrand() < 0.3 ) { scale = (m+n); shift = Math.floor(scale/2); }
	                 else { scale = (m+n)/2; shift = 0; }
	if (method != "Dual") {
	    for (j=1; j<=n; j++) {
		xinit[j] = Math.floor(scale*myrand())-shift;
		zinit[j] = Math.floor(scale*myrand())-3*shift;
       
	    }
	    for (i=1; i<=m; i++) {
		winit[i] = Math.floor(scale*myrand())-3*shift; 
		yinit[i] = Math.floor(scale*myrand())-shift; 
	    }
	}
	

	var seed0 = document.getElementById("seed").value;
	for (j=1; j<=n; j++) {
		c[j] = -zinit[j];
		for (i=1; i<=m; i++) {
		    c[j] -= yinit[i]*a[i][j];
		}
	        if ((method == "Dual"   && seed0 <  10000) || 
		    (method == "Primal" && seed0 >= 10000)) {
		    c[j]  = Math.floor((m+n)*myrand());
		    c[j]  += Math.floor((m+n)*myrand());
		    c[j]  += Math.floor((m+n)*myrand());
		    c[j]  *= -1;
		}
	}
    
   for (j=1; j<=m; j++) {
		 document.getElementById("lb"+j).value = 0;
         for (i=1; i<=n; i++) {
		    document.getElementById("lb"+j).value =0;
		}
        /* if ((method == "Primal" && seed0 <  10000) || 
		    (method == "Dual"   && seed0 >= 10000)) {
		   document.getElementById("lb"+j).value  = Math.floor(((m+2)+n)*myrand());
		document.getElementById("lb"+j).value*=-1;}*/
		}
        for (j=1; j<=m; j++) {
		 document.getElementById("ub"+j).value = "\u221e";}
      /*   for (i=1; i<=n; i++) {
		    document.getElementById("ub"+j).value =&#8734;
		}
         if ((method == "Primal" && seed0 <  10000) || 
		    (method == "Dual"   && seed0 >= 10000)) {
		   document.getElementById("ub"+j).value  = Math.floor(((m+2)+n)*myrand());
		}}*/
       
	
	
	for (i=1; i<=m; i++) {
		b[i] = winit[i];
		for (j=1; j<=n; j++) {
		    b[i] -= a[i][j]*xinit[j];
		}
       
		
	        if ((method == "Primal" && seed0 <  10000) || 
		    (method == "Dual"   && seed0 >= 10000)) {
		    b[i]  = Math.floor((m+n)*myrand());
		    b[i]  += Math.floor((m+n)*myrand());
		    b[i]  += Math.floor((m+n)*myrand());
		}
	}

     for (i=1; i<=m; i++)
     {if(n>2) {for(j=3;j<=n;j++){document.getElementById("vb"+i).value=b[i]+a[i][1]*document.getElementById("l"+(m+1)+","+1).value+a[i][j]*document.getElementById("l"+(m+1)+","+2).value+a[i][j]*document.getElementById("u"+(m+2)+","+j).value;}}
     else if(n==2){document.getElementById("vb"+i).value=b[i]+a[i][1]*document.getElementById("l"+(m+1)+","+1).value+a[i][2]*document.getElementById("u"+(m+2)+","+2).value;}
     else{document.getElementById("vb"+i).value=b[i]+a[i][1]*document.getElementById("l"+(m+1)+","+1).value;}}
     
	if (n==2 && method == "Primal" && myrand() < 0.8) {
		var xcenter = 1.0 + myrand()*m/9;
		var ycenter = 1.0 + myrand()*m/9;
		var r = 1.25*Math.sqrt(xcenter*xcenter+ycenter*ycenter);;
		var theta;
		var x0, y0;
		var nx, ny;
		for (i=1; i<=m; i++) {
			theta = 1.5*Math.PI*(i-myrand())/m - Math.PI/2;
			nx = r*Math.cos(theta);
			ny = r*Math.sin(theta);
			x0 = xcenter + nx;
			y0 = ycenter + ny;
			a[i][1] = -nx;
			a[i][2] = -ny;
			b[i] = nx*x0 + ny*y0;
			a[i][1] = Math.round(5*a[i][1]);
			a[i][2] = Math.round(5*a[i][2]);
			b[i]    = Math.round(5*b[i]);
		}
	}

	// ==================================================

	/*obj = 0;

	listlen = 0;
	for (var i=0; i<100; i++) rowlist[i] = -1;

	for (i=1; i<=m; i++) {
	     document.getElementById("w"+i).value = wlabel[i];
         // document.getElementById("lb0"+i).value = lblabel[i];
          // document.getElementById("ub0"+i).value = ublabel[i]// +" ";
	}
	element = document.getElementById("obj");
        var newwid = 1;
         var newwid1 = 1;
          var newwid2 = 1;
	if (element != null) { newwid = Math.max(newwid, element.value.visualLength());}
	for (i=1; i<=m; i++) {
	    var element = document.getElementById("w"+i);
       // var element1 =  document.getElementById("lb0"+i);
        
       // var element2 =  document.getElementById("ub0"+i);
	    newwid = Math.max(newwid, element.value.visualLength());
        
	    //newwid1 = Math.max(newwid1, element1.value.visualLength());
        
	   // newwid2 = Math.max(newwid2, element2.value.visualLength());
	}
        newwid += 10;
        newwid2 += 10;
        newwid1  += 10;
	var element = document.getElementById("obj");
	if (element != null) { element.style.width = newwid+"px";}
	for (i=1; i<=m; i++) {
	    var element = document.getElementById("w"+i);
         //var element1 =  document.getElementById("lb0"+i);
        
        //var element2 =  document.getElementById("ub0"+i);
	    element.style.width = newwid+"px";
        // element2.style.width = newwid2+"px";
         //element1.style.width = newwid1+"px";
      
	}
	for (j=1; j<=n; j++) {
	     document.getElementById("x0,"+j).value = xlabel[j];
         //document.getElementById("l0"+j).value = xlabel[j];
         //document.getElementById("u0"+j).value = xlabel[j];
        // +" ";
	     var wid = document.getElementById("x0,"+j).value.visualLength() + 10;
         //var wid1 = document.getElementById("l0"+j).value.visualLength()+10;
 // var wid2 = document.getElementById("u0"+j).value.visualLength()+10;
             for (i=0; i<=m; i++) {
	         document.getElementById("x"+i+","+j).value = xlabel[j];
            // +" ";
                 var element = document.getElementById("x"+i+","+j);
   
                 element.style.width = wid+"px";
               
                 
             }
  //            document.getElementById("l0"+j).value = xlabel[j];
    //         document.getElementById("u0"+j).value = xlabel[j];
      //       var element1 = document.getElementById("l0"+j);
        //          var element2 = document.getElementById("u0"+j);
          //           element1.style.width = wid1+"px";
            //     element2.style.width = wid2+"px";
	}*/

		if(n>2){
    for (j=1; j<=2; j++) {upperbound[j] = j;}
    for(j=3;j<=n;j++){lowerbound[j]=j;}
    }else if(n==2){upperbound[1]=1;lowerbound[2]=2;}else{upperbound[1]=1;}
	for (i=1; i<=m; i++) {basics[i] = n+j;}

	toGrid();

  } 

  function Undo() {
	var row, col;

	if (listlen > 0) { listlen--; } else { listlen = 99; }
	row = rowlist[listlen];
	col = collist[listlen];
	if (row != -1) {
		pivot(row,col);
	}
  }

  function Hint() {
	var tmp, eps=1e-6;
	/*if (method == "Primal w/ x0") {
	    if (listlen == 0) {
		tmp = 1e+10;
		for (i=1; i<=m; i++) {
		  if (b[i] < tmp) {
		    tmp = b[i];
		  }
		}
		for (i=1; i<=m; i++) {
		  if (tmp < -eps && b[i] < tmp+eps) {
		    document.getElementById("x"+i+","+n).className = "greenvar";
		  }
		}
	    } else {
	      for (j=1; j<=n; j++) {
	        if (c[j] > eps) {
		  tmp = 1e+10;
		  for (i=1; i<=m; i++) {
		    if (a[i][j] < -eps && -b[i]/a[i][j] < tmp) {
		      tmp = -b[i]/a[i][j];
		    }
		  }
		  for (i=1; i<=m; i++) {
		    if (a[i][j] < -eps && -b[i]/a[i][j] < tmp+eps) {
		      document.getElementById("x"+i+","+j).className = "greenvar";
		    }
		  }
	        }
	      }
	    }
	}
	else*/ if (method == "Primal") {
	    for (i=1; i<=m; i++) {
        element=document.getElementById("vb"+i).value;
        var elt=document.getElementById("lb"+i).value;
var elt1=document.getElementById("ub"+i).value;
	      if (element > elt1*(eps) || element < elt*(eps)) { return; }
	    }
 for (j=1; j<=n; j++) {
var element1=document.getElementById("l"+(m+1)+","+j).value;
var element2=document.getElementById("u"+(m+2)+","+j).value;
	      if( c[j]<-1e-10) {
		/*tmp = 1e+10;
		for (i=1; i<=m; i++) {
		  if (a[i][j] < -eps) {
		    tmp = -b[i]/a[i][j];
		  }
		}*/
		for (i=1; i<=m; i++) {
		  if (a[i][j] < -eps) {
		    document.getElementById("x"+i+","+j).className = "greenvar";
		  }
		}
	      }
	    }
	}
	else if (method == "Dual") {
	    for (j=1; j<=n; j++) {
	      if (c[j] > eps) { return; }
	    }
	    for (i=1; i<=m; i++) {
	      if (b[i] < -eps) {
		tmp = 1e+10;
		for (j=1; j<=n; j++) {
		  if (a[i][j] > eps && -c[j]/a[i][j] < tmp) {
		    tmp = -c[j]/a[i][j];
		  }
		}
		for (j=1; j<=n; j++) {
		  if (a[i][j] > eps && -c[j]/a[i][j] < tmp+eps) {
		    document.getElementById("x"+i+","+j).className = "greenvar";
		  }
		}
	      }
	    }
	}
	else if (method == "Lexicographic" || method == "Klee-Minty") {
	    var eps10 = 1e-20;
	    var e = [], be = [];
	    if (method == "Lexicographic") {factor = 1e-4;} 
	                              else {factor = 1e+2;}
	    e[1] = factor;
	    for (i=2; i<=m; i++) { e[i] = factor * e[i-1]; }
	    for (i=1; i<=m; i++) {
	      be[i] = b[i];
	      for (ii=1; ii<=m; ii++) {
		be[i] -= a[i][ii]*e[ii];
	      }
	      if (be[i] < -eps10) { return; }
	    }
	    for (j=mmn+1; j<=n; j++) {
	      if (c[j] > eps) {
		tmp = 1e+100;
		for (i=1; i<=m; i++) {
		  if (a[i][j] < -eps && -be[i]/a[i][j] < tmp) {
		    tmp = -be[i]/a[i][j];
		  }
		}
		for (i=1; i<=m; i++) {
		  if (a[i][j] < -eps && -be[i]/a[i][j] <= tmp+eps) {
		    document.getElementById("x"+i+","+j).className = "greenvar";
		  }
		}
	      }
	    }
	}
  }

  function updateColLabels(j) {
	var tmp0, tmp1, tmp2;
        var element = document.getElementById("x0,"+j);
      
	var newvalue = element.value;
    
	
	for (k=newvalue.length-1; k>0; k--) {
	    tmp0 = newvalue.substring(0, k);
	    tmp1 = newvalue.substring(k, k+1);
	    if (k<newvalue.length) {
		tmp2 = newvalue.substring(k+1, newvalue.length);
	    } else {
		tmp2 = null;
	    }
	    var c = tmp1.charAt(0);
	    if (c > '/' && c < ':') {
		k = parseInt(tmp1);
		newvalue = tmp0 + sub[k] + tmp2;
	    }
	}

        element.value = newvalue;
      
        var newwid = element.value.visualLength() + 10;
      
	for (i=0; i<=m+2; i++) {
	    var element = document.getElementById("x"+i+","+j);
	    element.value = newvalue;
            element.style.width = newwid+"px";
	}
    
	toGrid();
  }

  function updateRowLabel(i) {
	var tmp0, tmp1, tmp2;
	var element = document.getElementById("w"+i);
	var newvalue = element.value;
	for (k=newvalue.length-1; k>0; k--) {
	    tmp0 = newvalue.substring(0, k);
	    tmp1 = newvalue.substring(k, k+1);
	    if (k<newvalue.length) {
		tmp2 = newvalue.substring(k+1, newvalue.length);
	    } else {
		tmp2 = null;
	    }
	    var c = tmp1.charAt(0);
	    if (c > '/' && c < ':') {
		k = parseInt(tmp1);
		newvalue = tmp0 + sub[k] + tmp2;
	    }
	}
        element.value = newvalue;

        var newwid = element.value.visualLength();
	var element = document.getElementById("obj");
	if (element != null) { newwid = Math.max(newwid, element.value.visualLength());}
	for (i=1; i<=m; i++) {
	    var element = document.getElementById("w"+i);
	    newwid = Math.max(newwid, element.value.visualLength());
	}
        newwid += 10;
	var element = document.getElementById("obj");
	if (element != null) { element.style.width = newwid+"px";}
	for (i=1; i<=m; i++) {
	    var element = document.getElementById("w"+i);
	    element.style.width = newwid+"px";
	}

	toGrid();
  }

  var first_call = true;

  function start() {
	var i,j;
	var element, rowElement;
        var tmp;

	obj = 0;

	n = 1.*document.getElementById("n").value;

	for (i=0; i<=m0; i++) {
	    removeElements(document.querySelectorAll("#rowStuff"+i+" input"));
	    removeElements(document.querySelectorAll("#rowStuff"+i+" br"));
	}
	removeElements(document.querySelectorAll("#rowStuff"+(m0+1)+" input"));
    
	m0 = m+4; 

	// fmt = "Decimal";
	seed = 0;
        document.getElementById("seed").value = seed;

	listlen = 0;
	for (var i=0; i<100; i++) rowlist[i] = -1;


	if (method == "Primal") {
            for (j=1; j<=n; j++) { xlabel[j] = "x"+sub[j]; }
            for (i=1; i<=m; i++) { wlabel[i] = "w"+sub[i]; }
            for (i=1; i<=m; i++) { lblabel[i] = "lb"+sub[i]; }
            for (i=1; i<=m; i++) { ublabel[i] = "ub"+sub[i]; }
            for (i=1; i<=n; i++) { llabel[i] = "x"+sub[i]; }
            for (i=1; i<=n; i++) { ulabel[i] = "x"+sub[i]; }
	} else{}
	
	
	    zlabel = "\u03B6";
	
     add("text","",1 ,0,"readonly"        ,"sign" ,"md0"  );
   
 

        document.getElementById("md0").style.textAlign = "right";
      
	add("text","" +zlabel+ " ",1,0,"readonly","var"   ,"obj"   );
    document.getElementById("obj").style.textAlign = "center";
	add("text"," = "     ,3,0,"readonly","equals","e0"      );
	
	    add("text","0"       ,5 ,0,""        ,"val" ,"zstar");
	
	for (j=1; j<=n; j++) {
	    
	    add("text","  +"    ,3 ,0,"readonly","sign","plus"+j );
	    
	    add("text","0"       ,5 ,0,""        ,"val" ,"c"+j  );
  document.getElementById("c"+j).style.backgroundColor = "#F8F8F8";
	    add("text",xlabel[j],3 ,0,"","var" ,"x0,"+j);
        
       
          
        
	    element = document.getElementById("x0,"+j);
           element.style.backgroundColor="#ebebe0";
	    element.setAttribute("onchange","updateColLabels("+j+")");
	}add("text","  "    ,1 ,0,"readonly","sign","e"  );
         add("text"  ,""           ,1 ,0,"readonly","sign" ,"e" );
           add("text","  "    ,1 ,0,"readonly","equals","e"  );
add("text","",1 ,0,"readonly","sign"  ,"lb0"+0);
     add("text",""       ,1 ,0,"readonly","sign" ,"e"  );
   
    
   
     add("text","",1 ,0,"readonly","sign" ,"ub0"+0);
      add("text"," "    ,1 ,0,"readonly","sign","e" );
  

	for (i=1; i<=m; i++) {
     
      add("text","",1,i,"readonly","sign","mb"+i);
            document.getElementById("mb"+i).style.textAlign = "right";
     
    
	    add("text",wlabel[i],1 ,i,"","var"   ,"w"+i);   
	    element = document.getElementById("w"+i);
        element.style.textAlign = "center";
	    element.setAttribute("onchange","updateRowLabel("+i+")");
         add("text"," = "    ,3 ,i,"readonly","equals","e"+i   );
         
	     add("text","0"       ,5 ,i,""        ,"val"   ,"b"+i);  
	    for (j=1; j<=n; j++) {
		
                     
                    add("text"  ,"  -"        ,3,i,"readonly","sign" ,"minus"+i+","+j   );
                    tmp = document.getElementById("minus"+i+","+j);
                    tmp.style.backgroundColor = "#F8F8F8";
	            add("text"  ,"0"           ,5 ,i,""        ,"val"   ,"a"+i+","+j);
                    tmp = document.getElementById("a"+i+","+j);
                    tmp.style.backgroundColor = "#F8F8F8";
		    add("button",xlabel[j]+" ","",i,""        ,"butvar"   ,"x"+i+","+j);
		
	    } add("text"," = "    ,1 ,i,"readonly","equals","e"+i   );
         add("text"  ,"0"           ,1 ,i,""    ,"val"   ,"vb"+i);
          add("text","  "    ,1 ,i,"readonly","equals","e"+i   );
add("button",lblabel[i],1 ,i,"","butvar"   ,"lb0"+i);
 
     add("text","0"       ,1 ,i,""        ,"val" ,"lb"+i  );
   
     add("button",ublabel[i],1 ,i,"","butvar"   ,"ub0"+i);

tmp.style.textAlign="center";
      add("text"," 0 "    ,1 ,i,"","val","ub"+i  );
  
          element = document.createElement("br");
	rowElement = document.getElementById("rowStuff"+i);
	rowElement.appendChild(element);
	}
   
	for (i=1; i<=m; i++) {
	    for (j=1; j<=n; j++) {
	        var element = document.getElementById("x"+i+","+j);
	        element.setAttribute("onclick","gotClicked("+i+","+j+")");
	    }
	}
   

        add("text","",1,m+1,"readonly","sign","mb"+(m+1));
            document.getElementById("mb"+(m+1)).style.textAlign = "right";
        
          add("text","  "     ,1,m+1,"readonly","sign","e0"      );
  
	add("text","  "     ,3,m+1,"readonly","sign","e0"      );
	
	    add("text","  "     ,5,m+1,"readonly","sign","e0"      );
	
   
     for (j=1; j<=n; j++) {
		
                   
                    
                    add("text"  ,"  "        ,3,m+1,"readonly","sign" ,"minus"+(m+1)+","+j   );
                  
	            add("text"  ,"0"           ,5,m+1,""        ,"val"   ,"l"+(m+1)+","+j);
                    tmp = document.getElementById("l"+(m+1)+","+j);
                    tmp.style.backgroundColor = "#F8F8F8";
		    add("button",llabel[j]+"",3,m+1,"","butvar"   ,"x"+(m+1)+","+j);
		
	    } add("text","  "    ,1 ,m+1,"readonly","sign","e"  );
         add("text"  ,""           ,1 ,m+1,"readonly","sign" ,"e" );
           add("text","  "    ,1 ,m+1,"readonly","equals","e"  );
add("text","",1 ,m+1,"readonly","sign"  ,"lb0"+(m+1));
     add("text",""       ,1 ,m+1,"readonly","sign" ,"e"  );
   
    
   
     add("text","",1 ,m+1,"readonly","sign" ,"ub0"+(m+1));
      add("text"," "    ,1 ,m+1,"readonly","sign","e" );


           add("text","",1,m+2,"readonly","sign","mb"+(m+2));
            document.getElementById("mb"+(m+2)).style.textAlign = "right";
          add("text","  "     ,1,m+2,"readonly","sign","e0"      );
  
	add("text","  "     ,3,m+2,"readonly","sign","e0"      );
	
	    add("text","  "     ,5,m+2,"readonly","sign","e0"      );

     for (j=1; j<=n; j++) {
                    
                    add("text"  ,"  "        ,3,m+2,"readonly","sign" ,"minus"+(m+2)+","+j   );
                  
	            add("text"  ,"0"           ,5,m+2,""        ,"val"   ,"u"+(m+2)+","+j);
                    tmp = document.getElementById("u"+(m+2)+","+j);
                    tmp.style.backgroundColor = "#F8F8F8";
		    add("button",ulabel[j]+"","",m+2,"","butvar"   ,"x"+(m+2)+","+j);
		
	    } add("text","  "    ,1 ,m+2,"readonly","sign","e"  );
         add("text"  ,""           ,1 ,m+2,"readonly","sign" ,"e" );
           add("text","  "    ,1 ,m+2,"readonly","equals","e"  );
add("text","",1 ,m+2,"readonly","sign"  ,"lb0"+(m+2));
     add("text",""       ,1 ,m+2,"readonly","sign" ,"e"  );
   
    
   add("text","",1 ,m+2,"readonly","sign" ,"ub0"+(m+2));
      add("text"," "    ,1 ,m+2,"readonly","sign","e" );

    
	    element = document.createElement("br");
	    rowElement = document.getElementById("rowStuff"+(m+2));
	    rowElement.appendChild(element);
          element = document.createElement("br");
	    rowElement = document.getElementById("rowStuff"+(m+2));
	    rowElement.appendChild(element);
    
	add("button", "", 80, m+3, "readonly", "var", "basicvars");
	add("button", "", 80, m+4, "readonly", "var", "nonbasicvars");
	for (i=1; i<=m; i++) {
	    for (j=1; j<=n; j++) {
	        var element = document.getElementById("x"+i+","+j);
	        element.setAttribute("onclick","gotClicked("+i+","+j+")");
	    }
	}


	
	if (Math.random() <= 0.5) {
	    bark = new Audio("i-dont-think-so.m4a");
	} else {
	    bark = new Audio("apprentice_fired.m4a");
	}
	meg  = new Audio("hal9000.m4a");

	obj = 0;
	for (j=1; j<=n; j++) {
	    c[j] = 0;
	   /* if (method == "Primal w/ x0") c[n] = -1;*/
	}
	for (i=1; i<=m; i++) {
	    b[i] = 0;
	    a[i] = [];
        vb[i]=0;
        lb[i]=[];
        ub[i]=[];
	    for (j=1; j<=n; j++) {
		a[i][j] = 0;
	    }
     }
        for (i=m+1; i<=m+2; i++) {
	    l[i] = [];
	    u[i] = [];
	    for (j=1; j<=n; j++) {
		l[i][j] = 0;
        u[i][j] = 0;
        
	    }
	}

toGrid();
	
	if(n>2){
    for (j=1; j<=2; j++) {upperbound[j] = j;}
    for(j=3;j<=n;j++){lowerbound[j]=j;}
    }else if(n==2){upperbound[1]=1;lowerbound[2]=2;}else{upperbound[1]=1;}
	for (i=1; i<=m; i++) {basics[i] = n+j;}

        if (first_call == true) {
           first_call = false;
           var query = window.location.search.substring(1); // the 1 strips off the ? character
           var vars = query.split("&");
           for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if (pair[0] == "example") {
                  setExercise(pair[1]);
               }
           }
        }


        // ==================================================

	listlen = 0;
	for (var i=0; i<100; i++) rowlist[i] = -1;

	for (i=1; i<=m; i++) {
	    // document.getElementById("w"+i).value = wlabel[i];
         
	     document.getElementById("lb0"+i).value = lblabel[i];
         
	     document.getElementById("ub0"+i).value = ublabel[i];
      var wid1=  document.getElementById("lb0"+i).value.visualLength()+15;
              var element = document.getElementById("lb0"+i);
                 element.style.width = wid1+"px";
             var element1 = document.getElementById("ub0"+i);
                 element1.style.width = wid1+"px";
    // +" ";
	}// var wid1=  document.getElementById("lb0"+1).value.visualLength()+20;
              var element = document.getElementById("lb0"+(m+1));
                 element.style.width = wid1+"px";
             var element1 = document.getElementById("ub0"+(m+1));
                 element1.style.width = wid1+"px";
     
              var element = document.getElementById("lb0"+(m+2));
                 element.style.width = wid1+"px";
             var element1 = document.getElementById("ub0"+(m+2));
                 element1.style.width = wid1+"px";
              
              var element = document.getElementById("lb0"+0);
                 element.style.width = wid1+"px";
             var element1 = document.getElementById("ub0"+0);
                 element1.style.width = wid1+"px";
	element = document.getElementById("obj");
        var newwid = 1;
       
	/*if (element != null) { newwid = Math.max(newwid, element.value.visualLength());}
	for (i=1; i<=m; i++) {
	    var element = document.getElementById("w"+i);
	    newwid = Math.max(newwid, element.value.visualLength());
        var element1 = document.getElementById("lb0"+i);
	    newwid = Math.max(newwid, element1.value.visualLength());
        var element2 = document.getElementById("ub0"+i);
	    newwid = Math.max(newwid, element2.value.visualLength());
	}*/
        newwid += 10;
	/*var element = document.getElementById("obj");
	if (element != null) { element.style.width = newwid+"px";}
	for (i=1; i<=m; i++) {
	    var element = document.getElementById("w"+i);
	    element1.style.width = newwid+"px";
        var element1 = document.getElementById("lb0"+i);
	    element2.style.width = newwid+"px";
        var element2 = document.getElementById("ub0"+i);
	    element1.style.width = newwid+"px";
       
	}*/
	for (j=1; j<=n; j++) {
	     document.getElementById("x0,"+j).value = xlabel[j];
	     document.getElementById("x"+(m+1)+","+j).value = xlabel[j];
         
	     document.getElementById("x"+(m+2)+","+j).value = xlabel[j];
         // +" ";
	     var wid = document.getElementById("x"+(m+1)+","+j).value.visualLength()+15;
            
             for (i=0; i<=m+2; i++) {
	       
                 var element = document.getElementById("x"+i+","+j);
                 
                 element.style.width = wid+"px";
                 
             }
              
	}

		if(n>2){
    for (j=1; j<=2; j++) {upperbound[j] = j;}
    for(j=3;j<=n;j++){lowerbound[j]=j;}
    }else if(n==2){upperbound[1]=1;lowerbound[2]=2;}else{upperbound[1]=1;}
	for (i=1; i<=m; i++) {basics[i] = n+j;}
        console.log("start");
	toGrid();
  }
  function gotClicked(row,col) {

	rowlist[listlen] = row;
	collist[listlen] = col;
	if (listlen < 99) { listlen++; } else {listlen=0;}
	pivot(row,col);
  }

  function ck_edits() {
        var eps = 1e-4;
        var factor;
        if (fmt == 'Integer') factor = maxden; else factor = 1;
	if (method != "Klee-Minty") {
	  for (i=1; i<=m; i++) {
	    bb = fracDivide(document.getElementById("b"+i).value);
	    if (Math.abs(b[i] - bb/factor) > eps) {b[i] = bb/factor;}
	  }
	}

	for (j=1; j<=n; j++) {
	    cc = fracDivide(document.getElementById("c"+j).value);
	    if (Math.abs(c[j] - cc/factor) > eps) {c[j] = cc/factor;}
	}

	for (i=1; i<=m; i++) {
	    for (j=1; j<=n; j++) {
		aa = -fracDivide(document.getElementById("a"+i+","+j).value);
	        if (Math.abs(a[i][j] - aa/factor) > eps) {a[i][j] = aa/factor;}
	    }
	}

	if (method != "Klee-Minty") {
	  oo = document.getElementById("zstar").value;
	  if (Math.abs(obj - oo/factor) > eps) {obj = oo/factor;}
	}
    /*if (method != "Klee-Minty") {
	  bv = document.getElementById("vbasic").value;
	  if (Math.abs(vb - bv/factor) > eps) {obj = bv/factor;}
	}*/
  }

  function pivot(row,col) {
	leaving  = document.getElementById("w"+row).value;
	entering = document.getElementById("x0,"+col).value;

	// ck_edits();

	/* PIVOT HERE */
	var arow = [];
	var acol = [];
	var arowcol;
	var brow, ccol;
	var basicrow;

	basicrow = basics[row];
	basics[row] = lowerbound[col];
	lowerbound[col] = basicrow;
	
	for (i=1; i<=m; i++) { acol[i] = a[i][col]; }
	for (j=1; j<=n; j++) { arow[j] = a[row][j]; }
	arowcol = a[row][col];

	if (arowcol == 0) {
	    bark.play();
	    // THIS BLINKING CODE DOES NOT WORK
	    var element = document.getElementById("a"+row+","+col)
	    for (j=0; j<5; j++) {
		element.className = "pinkval";
		wait(200);
		element.className = "val";
		wait(200);
	    }
	    return;
	}

	document.getElementById("w"+row).value = entering;
	for (i=0; i<=m; i++) {
	     document.getElementById("x"+i+","+col).value = leaving;
	}

	for (i=1; i<=m; i++) {
	    for (j=1; j<=n; j++) {
		if (i != row && j != col) {
		    a[i][j] -= arow[j]*acol[i]/arowcol;
		} 
		if (i != row && j == col) {
		    a[i][j] /=  arowcol;
		} 
		if (i == row && j != col) {
		    a[i][j] /= -arowcol;
		} 
		if (i == row && j == col) {
		    a[i][j] = 1.0/arowcol;
		}
	    }
	}

	brow = b[row];
	for (i=1; i<=m; i++) {
	    if (i != row) {
		b[i] -= brow*acol[i]/arowcol;
	    } else {
		b[i] /= -arowcol;
	    }
	}

	ccol = c[col];
	for (j=1; j<=n; j++) {
	    if (j != col) {
		    c[j] -= ccol*arow[j]/arowcol;
	    } else {
		c[j] /= arowcol;
	    }
	}

	obj -= brow*ccol/arowcol;

        updateColLabels(col);
	toGrid();
  }

  function ck_opt()
  {
  	var i, j;
  	var optflag=true;
  
  	for (i=1; i<=m; i++) { 
	    b[i] = fracDivide(document.getElementById("b"+i).value);
	}
  
  	for (j=mmn+1; j<=n; j++) { 
	    c[j] = fracDivide(document.getElementById("c"+j).value);
	}
  
  	for (i=1; i<=m; i++) {
  		if (b[i] < -1e-10) {
  			optflag = false;
  		}
  	}
  
  	for (j=mmn+1; j<=n; j++) {
  		if (c[j] > 1e-10) {
  			optflag = false;
  		}
  	}
  
  	if (optflag == true) {
  		meg.play();
  	} else {
  		bark.play();
		/*
  		try {
  		    pf.opt_button.setBackground(pink);
  		    Thread.sleep(1000);
  		    pf.opt_button.setBackground(gray);
  		} catch(InterruptedException ie){};
		*/
  	}
  }
  
  function ck_p_unbdd()
  {
  	var i, j;
  	var d_infeas_flag=false;
  	var p_feas_flag=true;
  
  	for (i=1; i<=m; i++) { 
	    b[i] = fracDivide(document.getElementById("b"+i).value);
	}
  
  	for (j=mmn+1; j<=n; j++) { 
	    c[j] = fracDivide(document.getElementById("c"+j).value);
	}
  
  	for (i=1; i<=m; i++) {
  		for (j=1; j<=n; j++) {
  		   
			a[i][j] =
				-fracDivide(document.getElementById("a"+i+","+j).value);
  		}
  	}
  
  	for (j=mmn+1; j<=n; j++) {
  	    if (c[j] > 1e-10) {
  		d_infeas_flag = true;
  		for (i=1; i<=m; i++) {
  		    if (a[i][j] < -0.00001) {
  			d_infeas_flag = false;
  			break;
  		    }
  		}
  		if (d_infeas_flag == true) {
  		    for (i=1; i<=m; i++) {
  			if (b[i] < -0.00001 && a[i][j] < 0.00001) {
  			    d_infeas_flag = false;
  			    break;
  			}
  		    }
  		}
  		if (d_infeas_flag == true) break;
  	    }
  	}
  
  	if (d_infeas_flag == true) {
  		// reset();
  		meg.play();
  	} else {
  		bark.play();
		/*
  		try {
  		    pf.d_infeas_button.setBackground(pink);
  		    Thread.sleep(1000);
  		    pf.d_infeas_button.setBackground(gray);
  		} catch(InterruptedException ie){};
		*/
  	}
  }
  
  function ck_p_infeas()
  {
  	var i, j;
  	var p_infeas_flag=false;
  
  	for (i=1; i<=m; i++) { 
	    b[i] = fracDivide(document.getElementById("b"+i).value);
	}
  
  	for (j=mmn+1; j<=n; j++) { 
	    c[j] = fracDivide(document.getElementById("c"+j).value);
	}
  
  	for (i=1; i<=m; i++) {
  		for (j=1; j<=n; j++) {
  		   
			a[i][j] =
				-fracDivide(document.getElementById("a"+i+","+j).value);
  		    
  		}
  	}
  
  	for (i=1; i<=m; i++) {
  	    if (b[i] < -1e-10) {
  		p_infeas_flag = true;
  		for (j=mmn+1; j<=n; j++) {
  		    if (a[i][j] >  0.00001) {
  			p_infeas_flag = false;
  			break;
  		    }
  		}
  		if (p_infeas_flag == true) break;
  	    }
  	}
  
  	if (p_infeas_flag == true) {
  		// reset();
  		meg.play();
  	} else {
  		bark.play();
		/*
  		try {
  		    pf.p_infeas_button.setBackground(pink);
  		    Thread.sleep(1000);
  		    pf.p_infeas_button.setBackground(gray);
  		} catch(InterruptedException ie){};
		*/
  	}
  }

  function makePlot() {
        var eps;
        if ( (n==2 || (n==3 && method == "Primal w/ x0" )) && ctx != null) {
	  if (
                  (n==2 && lowerbound[1]==1 && upperbound[2]==2) 
                  ||
                  (n==3 && method == "Primal w/ x0" 
                        && lowerbound[1]==1 && lowerbound[2]==2 && upperbound[1]==1) 
             ){
           plotwid = 400;
	   ctx.fillStyle = "rgb(255,255,255)";
	   ctx.fillRect(0,0,plotwid,plotwid);

           for (i=1; i<=m; i++) {
	      // if (a[i][2] == 0) { a[i][2] = 1; }
	      /*
	      rr = Math.random();
	      gg = Math.random();
	      bb = Math.random();
	      */

	      eps = 1e-4*(Math.random()-0.5);

	      rr = (m-i+0.5)*(m-i+0.5);
	      gg = m*m/2.-(m/2.-i+0.5)*(m/2.-i+0.5);
	      bb = (i-0.5)*(i-0.5);
	      rgb = rr+gg+bb;
	      rr0 = Math.floor(255. * rr/rgb);
	      gg0 = Math.floor(255. * gg/rgb);
	      bb0 = Math.floor(255. * bb/rgb);
	      rr = Math.floor(255. * Math.sqrt(rr/rgb));
	      gg = Math.floor(255. * Math.sqrt(gg/rgb));
	      bb = Math.floor(255. * Math.sqrt(bb/rgb));
	      ctx.strokeStyle = 'rgba('+rr+','+gg+','+bb+','+0.8/(m+2)+')';
	      ctx.fillStyle   = 'rgba('+rr+','+gg+','+bb+','+0.8/(m+2)+')';
	      ctx.beginPath();
	      xx =  -20; yy = -(b[i]+a[i][1]*xx)/(a[i][2]+eps);
	      ctx.moveTo(xpx(xx),ypx(yy));
	      var veclen = Math.sqrt(a[i][1]*a[i][1]+a[i][2]*a[i][2]); 
	      xx =  20*a[i][1]/veclen;
	      yy =  20*a[i][2]/veclen;
	      ctx.lineTo(xpx(xx),ypx(yy));
	      xx =  20; yy = -(b[i]+a[i][1]*xx)/(a[i][2]+eps);
	      ctx.lineTo(xpx(xx),ypx(yy));

	      ctx.closePath();
	      ctx.fill();
      
	      ctx.strokeStyle = "black";
	      ctx.strokeStyle = 'rgb('+rr0+','+gg0+','+bb0+')';
	      ctx.beginPath();
	      if (Math.abs(a[i][2]) > 1e-4) {
	          xx = -2; yy = -(b[i]+a[i][1]*xx)/(a[i][2]+eps);
	          ctx.moveTo(xpx(xx),ypx(yy));
	          xx =  9; yy = -(b[i]+a[i][1]*xx)/(a[i][2]+eps);
	          ctx.lineTo(xpx(xx),ypx(yy));
	      } else {
	          yy = -2; xx = -(b[i]+a[i][2]*yy)/(a[i][1]+eps);
	          ctx.moveTo(xpx(xx),ypx(yy));
	          yy =  9; xx = -(b[i]+a[i][2]*yy)/(a[i][1]+eps);
	          ctx.lineTo(xpx(xx),ypx(yy));
	      }
	      ctx.stroke();
	   }

           for (i=1; i<=m; i++) {
              if (a[i][1] == 0 && a[i][2] == 0) break;
	      ctx.strokeStyle = 'rgb(0,0,0)';
	      ctx.fillStyle   = 'rgb(0,0,0)';
	      ctx.font = "18px Letter Gothic Std, sans-serif";
	      var txt = document.getElementById("w"+i).value+'=0';
	      var wid = ctx.measureText(txt).width;
	      var hit = 15;
	      var xs = [], ys = [];
	      var x2 = [], y2 = [];
	      var cnt = 0;
	      xs[0] =  -2; ys[0] = -(b[i]+a[i][1]*xs[0])/(a[i][2]+eps);
	      xs[1] =   9; ys[1] = -(b[i]+a[i][1]*xs[1])/(a[i][2]+eps);
	      ys[2] =  -2; xs[2] = -(b[i]+a[i][2]*ys[2])/(a[i][1]+eps);
	      ys[3] =   9; xs[3] = -(b[i]+a[i][2]*ys[3])/(a[i][1]+eps);
	      var minx =  1e+20;
	      var maxx = -1e+20;
	      for (var j=0; j<4; j++) {
		if (xs[j] < minx) {minx = xs[j];}
		if (xs[j] > maxx) {maxx = xs[j];}
	      }
	      for (var j=0; j<4; j++) {
		if (xs[j] != minx && xs[j] != maxx) {
			x2[cnt] = xs[j];
			y2[cnt] = ys[j];
			cnt++;
		}
	      }
	      // var p = Math.pow(2*Math.random()-1,1./3.);
	      var p = Math.random();
	      if (p < 0.5) {p = 0.1+0.6*p;} else {p = 0.9-0.6*(1-p);}
	      var q = 1-p;
	      xx = p*x2[0]+q*x2[1];
	      yy = p*y2[0]+q*y2[1];
	      ctx.save();
	      ctx.translate(xpx(xx),ypx(yy));
	      ctx.rotate(Math.atan(a[i][1]/(a[i][2]+eps)));
	      ctx.textAlign = "center";
	      ctx.fillText(txt, 0, 0);
	      ctx.restore();
	      // ctx.fillText(txt, xpx(xx)-wid/2,     ypx(yy)+hit/3);
	   }

	   txt = document.getElementById("x0,"+1).value+'=0';
	   wid = ctx.measureText(txt).width;
	   yy = 5.2 + Math.random()-0.5;
	   xx = 0;
	   ctx.save();
	   ctx.translate(xpx(xx),ypx(yy));
	   ctx.rotate(-Math.PI/2);
	   ctx.textAlign = "center";
	   ctx.fillText(txt, 0, 0);
	   ctx.restore();
	   // ctx.fillText(txt, xpx(xx)-wid/2,     ypx(yy)+hit/3);

	   txt = document.getElementById("x0,"+2).value+'=0';
	   wid = ctx.measureText(txt).width;
	   xx = 5.4 + Math.random()-0.5;
	   yy = 0;
	   ctx.save();
	   ctx.translate(xpx(xx),ypx(yy));
	   ctx.textAlign = "center";
	   ctx.fillText(txt, 0, 0);
	   ctx.restore();
	   // ctx.fillText(txt, xpx(xx)-wid/2,     ypx(yy)+hit/3);

	   rr = 10;
	   gg = 10;
	   bb = 10;
	   // Draw grid
	   ctx.strokeStyle = 'rgba('+rr+','+gg+','+bb+','+0.1+')';
	   for (i=-2; i<=9; i++) {
	     ctx.beginPath();
	     ctx.moveTo(xpx( -2.), ypx(i));
	     ctx.lineTo(xpx(  9.), ypx(i));
	     ctx.stroke();
	     ctx.beginPath();
	     ctx.moveTo(xpx(  i), ypx( -2.));
	     ctx.lineTo(xpx(  i), ypx(  9.));
	     ctx.stroke();
	   }
	   ctx.strokeStyle = 'rgba('+rr+','+gg+','+bb+','+0.8/(m+2)+')';
	   ctx.fillStyle   = 'rgba('+rr+','+gg+','+bb+','+0.2/(m+2)+')';
	   ctx.beginPath();
	   ctx.moveTo(xpx( 0.),ypx(-2.));
	   ctx.lineTo(xpx( 9.),ypx(-2.));
	   ctx.lineTo(xpx( 9.),ypx( 9.));
	   ctx.lineTo(xpx( 0.),ypx( 9.));
	   ctx.closePath();
	   ctx.fill();
	   ctx.strokeStyle = 'rgb('+rr+','+gg+','+bb+')';
	   ctx.beginPath();
	   ctx.moveTo(xpx( 0.), ypx(-2.));
	   ctx.lineTo(xpx( 0.), ypx( 9.));
	   ctx.stroke();

	   ctx.strokeStyle = 'rgba('+rr+','+gg+','+bb+','+0.8/(m+2)+')';
	   ctx.fillStyle   = 'rgba('+rr+','+gg+','+bb+','+0.2/(m+2)+')';
	   ctx.beginPath();
	   ctx.moveTo(xpx(-2.),ypx( 0.));
	   ctx.lineTo(xpx(-2.),ypx( 9.));
	   ctx.lineTo(xpx( 9.),ypx( 9.));
	   ctx.lineTo(xpx( 9.),ypx( 0.));
	   ctx.closePath();
	   ctx.fill();
	   ctx.strokeStyle = 'rgb('+rr+','+gg+','+bb+')';
	   ctx.fillStyle   = 'rgb('+rr+','+gg+','+bb+')';
	   ctx.beginPath();
	   ctx.moveTo(xpx( -2.), ypx(0.));
	   ctx.lineTo(xpx(  9.), ypx(0.));
	   ctx.stroke();

	   ctx.font = "12px Letter Gothic Std, sans-serif";
	   ctx.fillText("-2", xpx(-2.0 ), ypx(-0.3 ));
	   ctx.fillText( "9", xpx( 8.8 ), ypx(-0.3 ));
	   ctx.fillText("-2", xpx(-0.42), ypx(-2.0 ));
	   ctx.fillText( "0", xpx(-0.3 ), ypx(-0.3 ));
	   ctx.fillText( "9", xpx(-0.3 ), ypx( 8.7 ));
	  }

	  xx = 0; yy = 0;
	  for (i=1; i<=m; i++) {
	      if (basics[i] == 1) xx=b[i];
	      if (basics[i] == 2) yy=b[i];
	  }
	  ctx.fillStyle = "red";
	  fillArc(xpx(xx)-2, ypx(yy)-2, 4, 0, 360);
        }
  }

  function toGrid() {
	var element;
	var nnv = "      ";
    	var nnv1= "      ";
        var wid;
        var tmp = "";
        var eps = 1e-4;
        var tmp1="";
        var tmp2="";
        var tmp3="";
	/*makePlot();

        tmp = ""+myformat(obj);
        wid = Math.max(3,tmp.length);
        maxden = den;
        for (i=1; i<=m; i++) {
            tmp = ""+myformat(b[i]);
            wid = Math.max(wid, tmp.length);
            maxden = Math.max(maxden, den);
        }
        for (i=1; i<=m; i++) {
            tmp = ""+myformat(lb[i]);
            wid = Math.max(wid, tmp.length);
            maxden = Math.max(maxden, den);
        }
        for (i=1; i<=m; i++) {
            tmp = ""+myformat(ub[i]);
            wid = Math.max(wid, tmp.length);
            maxden = Math.max(maxden, den);
        }
        for (i=1; i<=m; i++) {
            tmp = ""+myformat(vb[i]);
            wid = Math.max(wid, tmp.length);
            maxden = Math.max(maxden, den);
        }
	

	for (j=1; j<=n; j++) {
            tmp = ""+myformat(c[j]);
            wid = Math.max(3,tmp.length);
            maxden = Math.max(maxden, den);
            for (i=1; i<=m; i++) {
                tmp = ""+myformat(-a[i][j]);
                wid = Math.max(wid, tmp.length);
                maxden = Math.max(maxden, den);
            
            }
           
            document.getElementById("c"+j).setAttribute("size", wid);
            for (i=1; i<=m; i++) {
                document.getElementById("a"+i+","+j).setAttribute("size", wid);
            }
           
               document.getElementById("l"+(m+1)+","+j).setAttribute("size", wid);
             document.getElementById("u"+(m+2)+","+j).setAttribute("size", wid);
            
            
           document.getElementById("x0,"+j).setAttribute("size",
           document.getElementById("x1,"+j).getAttribute("value").length+1);
        }
*/
      
        tmp="subject to:   "+maxden+" ".length;
            document.getElementById("md"+0).setAttribute("size", tmp);
    for(i=1;i<=m+2;i++){
            document.getElementById("mb"+i).setAttribute("size", tmp);}
   
                
       // tmp1="Lowerbounduppp".length;
        //tmp2=document.getElementById("lb0"+1).size;
         //tmp3=document.getElementById("lb"+1).size;
         
           // document.getElementById("md"+3).setAttribute("size", 2*(tmp2+tmp3));    
//document.getElementById("md"+4).setAttribute("size", tmp1);


	for (j=1; j<=n; j++) {
	    element = document.getElementById("c"+j);
element2 = document.getElementById("u"+(m+2)+","+j);
element1 = document.getElementById("l"+(m+1)+","+j);
	    element.value = myformat2(c[j]);
	    if (Math.abs(c[j]) < 1e-10) { 
                  if (vis == "Dimmed")    { 
                          element.className = "zeroval"; 
                          document.getElementById("x0,"+j).className = "zerovar"; 
                          document.getElementById("plus"+j).className = "graysign"; 
                  } else 
                  if (vis == "Invisible") { 
                          element.className = "whiteval"; 
                          document.getElementById("x0,"+j).className = "whitevar"; 
                          document.getElementById("plus"+j).className = "whitesign"; } else 
                  if (vis == "Visible")   { 
                          element.className = "val";  
                          document.getElementById("x0,"+j).className = "var"; 
                          if (document.getElementById("plus"+j) != null)
                              document.getElementById("plus"+j).className = "sign"; }
            } else { 
                  element.className = "val"; 
                  document.getElementById("x0,"+j).className = "var"; 
                  if (document.getElementById("plus"+j) != null)
                      document.getElementById("plus"+j).className = "sign"; 
            }
             //if ((method != "Klee-Minty" && method != "Lexicographic") || j>m) {
             
	        if( (element2.style.backgroundColor=="rgb(179, 179, 255)" &&c[j]<-1e-10)||(element1.style.backgroundColor=="rgb(255, 170, 128)" &&c[j]>1e-10))
          { element.style.backgroundColor="#FFAAFF"; 
                                   document.getElementById("x0,"+j).className = "var"; }
           
           
	     nnv1 += document.getElementById("l"+(m+1)+","+j).value + " \u2264" +  document.getElementById("x0,"+j).value +"\u2264 " +document.getElementById("u"+(m+2)+","+j).value ;
	   if(j<n){nnv1 +=";  ";}
	    
	}
for (i=1; i<=m+2; i++) {
            element = document.getElementById("mb"+i); 
            if (fmt == "Integer" && maxden != 1) { 
                    element.value = "            "+maxden; 
            } else { 
                    element.value = "            "; 
            }}
              element = document.getElementById("md0"); 
        if (fmt == "Integer" && maxden != 1) { 
                element.value = "maximize:   "+maxden; 
        } else { 
                element.value = "maximize:    "; 
        }
           element = document.getElementById("mb1"); 
        if (fmt == "Integer" && maxden != 1) { 
                element.value = "subject to:   "+maxden; 
        } else { 
                element.value = "subject to:    "; 
        }
          element = document.getElementById("mb"+(m+1)); 
        if (fmt == "Integer" && maxden != 1) { 
                element.value = "lowerbound:   "+maxden; 
        } else { 
                element.value = "lowerbound:    "; 
        }
          element = document.getElementById("mb"+(m+2)); 
        if (fmt == "Integer" && maxden != 1) { 
                element.value = "upperbound:   "+maxden; 
        } else { 
                element.value = "upperbound:    "; 
        }
	for (i=1; i<=m; i++) {
	  if (method != "Klee-Minty") {
            /*element = document.getElementById("md"+i); 
            if (fmt == "Integer" && maxden != 1) { 
                    element.value = "            "+maxden; 
            } else { 
                    element.value = "            "; 
            }*/
           
            element = document.getElementById("vb"+i);  
           
             element1 = document.getElementById("lb"+i);  
           
              element2 = document.getElementById("ub"+i);  
          
	    if (element1.value*(1e-10) > element.value || element2.value*(1e-10)< element.value) { element.className = "pinkval"; } else
        if (element1.value<=element.value <=  element2.value) { 
                                if (vis == "Dimmed") {
                                 element.className = "zeroval"; } else
                                if (vis == "Invisible") {
                                 element.className = "whiteval"; } else
                                if (vis == "Visible") {
                                 element.className = "val"; } 
                               } else
	                       { element.className = "val"; }
	  }
        
		nnv += document.getElementById("lb"+i).value + " \u2264" +  document.getElementById("w"+i).value +" \u2264" +document.getElementById("ub"+i).value;
	  if(i<m){nnv+=";  ";}
	}
    for (i=1; i<=m; i++) {
		element = document.getElementById("b"+i);
		element.value = myformat2(b[i]);
	        if (Math.abs(b[i]) < 1e-10) { 
                  if (vis == "Dimmed")    { element.className = "zeroval"; } else
                  if (vis == "Invisible") { element.className = "whiteval"; } else
                  if (vis == "Visible")   { element.className = "val"; } 
                } else { 
                                            element.className = "val"; }}
                
     /*   element = document.getElementById("md1"); 
        if (fmt == "Integer" && maxden != 1) { 
                element.value = "subject to:   "+maxden; 
        } else { 
                element.value = "subject to:   "; 
        }*/

	for (i=1; i<=m; i++) {
	    for (j=1; j<=n; j++) {
		element = document.getElementById("a"+i+","+j);
		element.value = myformat2(-a[i][j]);
	        if (Math.abs(a[i][j]) < 1e-10) { 
                  if (vis == "Dimmed")    { element.className = "zeroval"; } else
                  if (vis == "Invisible") { element.className = "whiteval"; } else
                  if (vis == "Visible")   { element.className = "val"; } 
                } else { 
                                            element.className = "val"; 
                }
	        element = document.getElementById("x"+i+","+j);
                if (Math.abs(a[i][j]) < 1e-10) { 
                  if (vis == "Dimmed")    { element.className = "zerobutvar"; element.disabled = true; } else
                  if (vis == "Invisible") { element.className = "graybutvar"; element.disabled = true; } else
                  if (vis == "Visible")   { element.className = "butvar";  element.disabled = false;}
                } else {
                                            element.className = "butvar";  element.disabled = false; 
                }
	        element = document.getElementById("minus"+i+","+j);
                if (!(method == "Klee-Minty" && j==1)) 
                if (Math.abs(a[i][j]) < 1e-10) { 
                  if (vis == "Dimmed")    { element.className = "graysign"; } else
                  if (vis == "Invisible") { element.className = "whitesign"; } else
                  if (vis == "Visible")   { element.className = "sign"; }
                } else {
                                            element.className = "sign"; 
                }
                
	    }
	}



        console.log("hello bob");
	//if (method != "Klee-Minty") {
	  //  element = document.getElementById("md0");   
          //  if (fmt == "Integer" && maxden != 1) { 
            //        element.value = "max   "+maxden+" "; 
            //} else { 
              //      element.value = "maximize "; 
            //}
	  /*  element = document.getElementById("zstar"); 
            element.value = myformat2(obj);
            console.log("obj = "+obj);
           // if (obj == 0) { element.className = "whiteval"; } else 
                          { element.className = "val"; }
            element = document.getElementById("plus"+1);
           // if (obj == 0) { element.className = "whitesign"; } *?
	
	}*/

	if (listlen == 0) {
	    element = document.getElementById("basicvars");
	    element.value = nnv;
	    element.style.color = "gray";
	}
    if (listlen == 0) {
	    element = document.getElementById("nonbasicvars");
	    element.value = nnv1;
	    element.style.color = "gray";
	}
  }

  function fillArc(x,y,r,theta0, theta1)
  {
	ctx.beginPath();
	ctx.arc(x+r/2,y+r/2,r/2,theta0*Math.PI/180,theta1*Math.PI/180);
	ctx.fill();
  }

  var log_of_10 = Math.log(10);
  function log10(x)
  {
        return 0.0+Math.log(x)/log_of_10;
  }

  function myformat(x) {
	var ratio=contFrac(width,precision,x)+"";
        var digits = Math.ceil(log10(10*maxden));
        if (digits == 1) digits = 0;
        if (maxden == 2) digits = 1;
        if (maxden == 5) digits = 1;
        if (maxden == 10) digits = 1;
	/*if (fmt == "Decimal") {
	    return sprintf("%0."+digits+"f", x);
	    // return -sprintf("%0."+digits+"f", -x);
	    // return -sprintf("%10.6f", -x);
	} else {*/
	    return ratio;
	//}
  }

  function myformat2(x) {
        if (fmt == "Integer") {
            return myformat(maxden*x);
        } else {
            return myformat(x);
        }
  }

  var num, den, maxden;

  function contFrac(width, precision, t) {
        var bj=0, Aj=0, Aj1, Aj2, Bj=1, Bj1, Bj2;
        var pos;
        var tj, maxDen = Math.pow(10, precision);
        var numstr0, numstr;
        var width4 = width+9;
    
        if (t >= 0) { pos = true;   tj =  t; } 
        else        { pos = false;  tj = -t; }
    
        bj  = Math.floor(tj+1.0e-12);
        Aj  = bj; Aj1 = 1;
        Bj  = 1;  Bj1 = 0;
        num = Aj;
        den = Bj;
        if (!pos) {num = -num;}
        numstr0 = "";
        numstr = fracString(num, den, width4, precision);
        if (tj == bj){ return numstr; }
        tj = 1/(tj-bj);
        while (Math.abs(t - num/(1.0*den)) > 1.0e-12 ) {
	    Aj2 = Aj1; Aj1 = Aj;
	    Bj2 = Bj1; Bj1 = Bj;
	    
	    bj = Math.floor(tj+1.0e-12);
	    Aj = bj*Aj1 + Aj2;
	    Bj = bj*Bj1 + Bj2;
    
	    num = Aj;
	    den = Bj;
    
	    if (!pos) {num = -num;}
	    numstr0 = numstr;
	    numstr = fracString(num, den, width4, precision);
	    if (numstr.length >= width4 || Bj >= maxDen) {
	        return numstr0;
	    }
	    tj = 1/(tj-bj);
        }

        return numstr;
  } 

  function fracString(num, den, width, precision)
  {
        var numstr = "" + num;
        var len = numstr.length;

        for (var k=len; k<width-precision-1; k++) {
	    numstr = " " + numstr;
        }
    
        if (den == 1) {
	    return(numstr+"");
        } else {
	    return(numstr+"/"+den);
        }
  }

  function wait(ms) {
	var start = new Date().getTime();
	var end = start;
	while (end < start + ms) {
	    end = new Date().getTime();
	}
  }

// Random number generator 
// Because Math.random() does not support seeds in javascript

  var seed = 0;
  var randa = 1103515245;
  var randm = 4294967296;
  var randc = 12345;

  function myseed(v) {
	v = 1*v.valueOf(); 
	if (v == 0) {
	    seed = Math.floor(randm*Math.random());
	} else {
	    seed = v;
	}
  }

  function myrand() {
	if (seed == 0) {
	    seed = Math.floor(randm*Math.random());
	}
	seed = (randa*seed+randc)%randm;
	return (1.0*seed/(randm-1));
  }

  function fracDivide(s) {
	var i;
	var x;
	var num;
	var den;

	i = s.indexOf("/");
	if (i != -1) {
		num = s.substring(0,i);
		den = s.substring(i+1);
		// alert("s = "+s+", num = "+num+", den = "+den);
		x = num/den;
	} else {
		// alert("s = "+s);
		x = 1.0*s;
	}

	return x;
  }

  // From https://blog.mastykarz.nl/measuring-the-length-of-a-string-in-pixels-using-javascript/

  String.prototype.visualLength = function() 
  {
          var ruler = $("ruler");
          ruler.innerHTML = this;
          return ruler.offsetWidth;
  }
  function $(id)
  {
    return document.getElementById(id);
  }
</SCRIPT>
</HEAD>

<BODY onload="start()" bgcolor="white">
<span id="ruler"></span>
<font size="+0">
<center>
<H2>Simple Pivot Tool</H2>
Go general: &nbsp; &nbsp;
Constraints = <input size="3" value="3" class="input" id="m" onchange="setm(this.value)">,
Variables   = <input size="3" value="4" class="input" id="n" onchange="setn(this.value)">.
	    &nbsp; &nbsp;
	    Labels:
	    <select class="input" id="method" onchange="setMethod( this.value )"> 
	      <option value="Primal">Primal</option> 
	      <!--
	      <option value="Primal w/ x0">Primal w/ x0</option> 
	      -->
	    <!-- <option value="Lexicographic">Lexicographic</option> 
	      <option value="Klee-Minty">Klee-Minty</option> 
	      <option value="Dual">Dual</option> -->
	    </select>,
	    &nbsp; &nbsp;
	    <button class="input" onclick="start()">Clear</button>
	    <p>
Seed = <input size="5" value="0" class="input" id="seed" onchange="myseed(this.value)">
	    &nbsp;
<button class="input" onclick="genrand()">Generate Random Problem</button>
	    <p>
Or: &nbsp; &nbsp;
Select an Exercise from <i>Linear Programming: Foundations and Extensions</i>:
	    <select class="input" onchange="setExercise( this.value )"> 
	      <option value="--">--</option> 
	    </select>
	    <p>
<div class="row">
<div class="column"> <canvas id="blah" width="0" height="0"></canvas> </div>
<div class="column">
<p>
<button class="input" onclick="Hint()">Hint</button>
	    &nbsp; &nbsp;
<button class="input" onclick="Undo()">Undo</button>
	<!--
	    &nbsp; &nbsp;
<button onclick="reset()">Reset</button>,
	-->
<p>
	<!--
	    &nbsp; &nbsp;
	-->
	    Number format: 
	    <select class="input" onchange="setFormat( this.value )"> 
	      <option value="Fraction">Fraction</option> 
	      <option value="Decimal">Decimal</option> 
	      <option value="Integer">Integer</option> 
	    </select>

	    &nbsp; &nbsp;
	    Zero Visibility: 
	    <select class="input" onchange="setVisibility( this.value )"> 
	      <option value="Visible">Visible</option> 
	      <option value="Dimmed">Dimmed</option> 
	      <option value="Invisible">Invisible</option> 
	    </select>
	    <p>
<FORM>
	    <h3> Current Dictionary </h3>
	    <p>

<div id="rowStuff0"></div>
<p>
<div id="rowStuff1"></div>
<div id="rowStuff2"></div>
<div id="rowStuff3"></div>
<div id="rowStuff4"></div>
<div id="rowStuff5"></div>
<div id="rowStuff6"></div>
<div id="rowStuff7"></div>
<div id="rowStuff8"></div>
<div id="rowStuff9"></div>
<div id="rowStuff10"></div>
<div id="rowStuff11"></div>
<div id="rowStuff12"></div>
<div id="rowStuff13"></div>
<div id="rowStuff14"></div>
<div id="rowStuff15"></div>
<div id="rowStuff16"></div>
<div id="rowStuff17"></div>
<div id="rowStuff18"></div>
<div id="rowStuff19"></div>
</FORM>
<p>
<button class="input" onclick="ck_opt()">Optimal</button> &nbsp; &nbsp;
<button class="input" onclick="ck_p_infeas()">Infeasible</button> &nbsp; &nbsp;
<button class="input" onclick="ck_p_unbdd()">Unbounded</button> 
</div>
<div class="column"> <p> <canvas id="plot2d" width="0" height="0"></canvas> <p> </div>
</div>

</BODY>
</HTML>

